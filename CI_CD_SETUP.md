# Настройка CI/CD для проекта

## Что такое CI/CD?

CI/CD (Continuous Integration/Continuous Deployment) - это практика автоматизации процессов разработки, которая включает:

1. **Continuous Integration (CI)**:
   - Автоматическая сборка проекта
   - Запуск тестов
   - Проверка качества кода
   - Раннее обнаружение ошибок

2. **Continuous Deployment (CD)**:
   - Автоматический деплой на сервер
   - Автоматическое обновление приложения
   - Откат изменений при проблемах

## Настройка GitHub Actions

### 1. Подготовка репозитория

1. Убедитесь, что ваш проект находится в GitHub репозитории
2. Создайте ветку `main` (если её ещё нет)
3. Убедитесь, что все тесты проходят локально

### 2. Настройка секретов в GitHub

В настройках вашего GitHub репозитория (Settings -> Secrets and variables -> Actions) добавьте следующие секреты:

- `SSH_PRIVATE_KEY`: Ваш приватный SSH ключ для доступа к серверу
- `SERVER_HOST`: IP-адрес или домен вашего сервера
- `SERVER_USER`: Имя пользователя для SSH-подключения

### 3. Настройка сервера

1. Создайте пользователя для деплоя:
   ```bash
   sudo adduser deploy
   sudo usermod -aG docker deploy
   ```

2. Настройте SSH-ключи:
   ```bash
   sudo mkdir -p /home/deploy/.ssh
   sudo touch /home/deploy/.ssh/authorized_keys
   sudo chown -R deploy:deploy /home/deploy/.ssh
   ```

3. Добавьте публичный ключ в `authorized_keys`

### 4. Проверка работоспособности

1. Сделайте тестовый коммит в ветку `main`
2. Проверьте выполнение пайплайна в разделе Actions вашего репозитория
3. Убедитесь, что деплой прошел успешно

## Процесс работы CI/CD

1. **При пуше в main**:
   - Запускаются все тесты
   - Проверяется сборка проекта
   - Если всё успешно, происходит деплой

2. **При создании Pull Request**:
   - Запускаются все тесты
   - Проверяется сборка проекта
   - Деплой не происходит

## Мониторинг и отладка

1. **Просмотр логов**:
   - В GitHub: Actions -> Выберите workflow -> Выберите run
   - На сервере: `docker-compose logs -f`

2. **Откат изменений**:
   ```bash
   git revert <commit-hash>
   git push origin main
   ```

## Рекомендации

1. **Тестирование**:
   - Пишите тесты для нового функционала
   - Поддерживайте покрытие тестами на уровне 80%+

2. **Коммиты**:
   - Используйте осмысленные сообщения коммитов
   - Следуйте conventional commits

3. **Безопасность**:
   - Регулярно обновляйте зависимости
   - Проверяйте уязвимости в коде
   - Не храните секреты в репозитории

## Полезные команды

```bash
# Проверка статуса CI/CD
docker-compose ps

# Просмотр логов
docker-compose logs -f

# Принудительный деплой
git commit --allow-empty -m "Trigger deployment"
git push origin main
``` 